# Session 004 - Feb 19, 2026

## What was done this session

### Project infrastructure built
- Added **Issue Tracking** rules to `CLAUDE.md`: dual system using GitHub Issues + in-repo `issue_documentations/BUGS.md`, with a full entry format per bug (root cause, attempts, confidence levels, lessons)
- Added **Honesty and Caution Rules** to `CLAUDE.md`: no silent guessing, smallest possible change, stop and ask when stuck, flag risks proactively, always state confidence level
- Created `issue_documentations/BUGS.md` - the in-repo bug history file
- Created `open_questions/debugging_and_testing.md` - documents the LLM vs human debugging limitation, the collaborative console.log workaround idea, and automated testing as a future consideration
- Created `issue_documentations/bug_references/` - folder for Ali to drop reference screenshots, with naming convention

### Bug #1 fixed: iOS Safari panel drift (3 attempts)
- **Attempt 1:** Changed `max-height: 90vh` to `height: 72vh` - did not work on iPhone
- **Attempt 2:** Changed to `top: 28%; bottom: 0` - did not work on iPhone, but Ali provided Windows screenshots showing it worked on desktop
- **Key insight from Windows screenshots:** the CSS was never the problem. Desktop worked fine. Problem was iOS-specific.
- **Attempt 3:** Added Visual Viewport API listeners (`window.visualViewport`) to dynamically adjust `panel.style.bottom` when the keyboard opens/closes. This worked.
- Root cause: iOS Safari distinguishes between the layout viewport and visual viewport. When the keyboard opens, the visual viewport shrinks but fixed elements stay anchored to the layout viewport, causing them to shift visually. The Visual Viewport API is the standard fix.

### Bug #2 partially attempted: search results order (2 attempts, still open)
- **Attempt 1:** Added missing generic `.hidden { display: none }` CSS rule - this fixed the CSS hiding issue (classList operations had no visual effect before) but did not fix the ordering
- **Attempt 2:** Swapped `#food-list` and `#recent-section` in HTML so all foods renders at top and recent at bottom. Also hid recent during search.
- **Problem with attempt 2:** Ali clarified that recent foods should NOT be hidden during search - they should always be visible below the food list. This was an assumption made without confirming with Ali.
- Issue #2 remains open.

### Bug clarification rules and insights folder added
- `CLAUDE.md`: added "Bug Clarification Rules" section - always ask device/browser upfront, restate understanding before coding, never choose ambiguous UX behaviour unilaterally, request screenshots for visual bugs
- `insights/collaborative_debugging.md`: documents the human-agent debugging loop, why screenshots helped break bug #1, and what to do differently next time

**Files changed this session:**
- `CLAUDE.md` - issue tracking, honesty rules, and bug clarification rules added
- `issue_documentations/BUGS.md` - created, bug #1 closed, bug #2 open with two failed attempts documented
- `issue_documentations/bug_references/` - created with 5 reference screenshots (3 iPhone, 2 Windows)
- `open_questions/debugging_and_testing.md` - created
- `insights/collaborative_debugging.md` - created
- `js/ui.js` - Visual Viewport API fix for iOS, panel order changes
- `index.html` - panel body HTML restructure
- `css/styles.css` - added generic `.hidden { display: none }` rule

---

## Next steps

1. **Fix bug #2 properly** - show all foods at top, recent foods ALWAYS visible below (even during search). Do not hide recent. Confirm with Ali before touching code.

2. **Test bug #2 fix on iPhone** - all ordering changes have only been tested on desktop so far

3. **Delete food entries** - swipe left or tap to delete, `Storage.removeFoodEntry()` already exists

4. **Visual design polish** - match reference screenshots in `docs/samples/`. Main screen still uses horizontal progress bars instead of circular ring charts.

5. **Scrollable nutrition details panel** - the reference design shows fat/carb breakdown rows below the serving size inputs. Not built yet.

---

## High-level notes for the developer

- **The Visual Viewport API fix is the right long-term solution for iOS Safari bottom sheets.** Any future full-screen overlay or bottom sheet that contains an input field will need the same treatment. The pattern is: listen to `window.visualViewport` resize/scroll events, compute keyboard height as `window.innerHeight - window.visualViewport.height - window.visualViewport.offsetTop`, set `element.style.bottom` to that value. Clean up listeners on close.

- **The generic `.hidden { display: none }` rule was missing from the start.** This means any element that was being toggled with `classList.add('hidden')` / `classList.remove('hidden')` - OTHER than the three elements with specific rules - was never actually hiding. This could be affecting other parts of the app too. Worth auditing.

- **Issue #2 is not fixed.** Do not assume the current ordering code is correct. The desired behaviour is: food list (or filtered results) always at top, recent always at bottom, never hidden.

---

## Current challenges and anticipated risks

- **LLM debugging limitation confirmed in practice.** Bug #1 took 3 attempts because I couldn't test on iPhone. The turning point was Ali sharing Windows screenshots, which isolated the problem as iOS-specific. Collaborative screenshot sharing proved to be an effective substitute for interactive debugging.

- **UX decisions need explicit confirmation.** Bug #2 attempt 2 made an assumption ("hide recent during search") that turned out to be wrong. The rule should be: when a ticket has ambiguous behaviour ("either hidden or shown below"), always ask before coding.

- **No automated tests.** Every bug fix is validated manually on device. This will become increasingly fragile as the app grows. Documented in `open_questions/debugging_and_testing.md`.
